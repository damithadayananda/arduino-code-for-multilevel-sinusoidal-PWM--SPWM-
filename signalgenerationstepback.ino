#include <avr/pgmspace.h> 
#include "avr/io.h"
const uint16_t sinwave[200] PROGMEM = {
0x19D, 0x1A9, 0x1B6, 0x1C2, 0x1CF, 0x1DB, 0x1E7, 0x1F3, 0x200, 0x20C, 0x217, 0x223, 0x22F, 0x23A, 0x246, 0x251, 0x25C, 0x266, 0x271, 0x27B, 
0x285, 0x28F, 0x299, 0x2A2, 0x2AB, 0x2B4, 0x2BC, 0x2C4, 0x2CC, 0x2D4, 0x2DB, 0x2E2, 0x2E8, 0x2EF, 0x2F4, 0x2FA, 0x2FF, 0x304, 0x308, 0x30C, 
0x310, 0x313, 0x316, 0x319, 0x31B, 0x31D, 0x31E, 0x31F, 0x320, 0x320, 0x320, 0x31F, 0x31E, 0x31D, 0x31B, 0x319, 0x316, 0x313, 0x310, 0x30C, 
0x308, 0x304, 0x2FF, 0x2FA, 0x2F4, 0x2EF, 0x2E8, 0x2E2, 0x2DB, 0x2D4, 0x2CC, 0x2C4, 0x2BC, 0x2B4, 0x2AB, 0x2A2, 0x299, 0x28F, 0x285, 0x27B, 
0x271, 0x266, 0x25C, 0x251, 0x246, 0x23A, 0x22F, 0x223, 0x217, 0x20C, 0x200, 0x1F3, 0x1E7, 0x1DB, 0x1CF, 0x1C2, 0x1B6, 0x1A9, 0x19D, 0x190, 
0x183, 0x177, 0x16A, 0x15E, 0x151, 0x145, 0x139, 0x12D, 0x120, 0x114, 0x109, 0x0FD, 0x0F1, 0x0E6, 0x0DA, 0x0CF, 0x0C4, 0x0BA, 0x0AF, 0x0A5,
0x09B, 0x091, 0x087, 0x07E, 0x075, 0x06C, 0x064, 0x05C, 0x054, 0x04C, 0x045, 0x03E, 0x038, 0x031, 0x02C, 0x026, 0x021, 0x01C, 0x018, 0x014,
0x010, 0x00D, 0x00A, 0x007, 0x005, 0x003, 0x002, 0x001, 0x000, 0x000, 0x000, 0x001, 0x002, 0x003, 0x005, 0x007, 0x00A, 0x00D, 0x010, 0x014,
0x018, 0x01C, 0x021, 0x026, 0x02C, 0x031, 0x038, 0x03E, 0x045, 0x04C, 0x054, 0x05C, 0x064, 0x06C, 0x075, 0x07E, 0x087, 0x091, 0x09B, 0x0A5,
0x0AF, 0x0BA, 0x0C4, 0x0CF, 0x0DA, 0x0E6, 0x0F1, 0x0FD, 0x109, 0x114, 0x120, 0x12D, 0x139, 0x145, 0x151, 0x15E, 0x16A, 0x177, 0x183, 0x190};

const uint16_t triwave[20] PROGMEM ={0,20,40,60,80,100,120,140,160,180,200,180,160,140,120,100,80,60,40,20};

int counta=0;
int j;
int ref=46;

void setup() 
{
  //***********
    ADMUX=(1<<REFS0);                         // For Aref=AVcc;
  ADCSRA=(1<<ADEN)|(1<<ADPS2)|(1<<ADPS1)|(1<<ADPS0);
  uint8_t ch=ch&0b00000111;
  ADMUX|=ch;
  
  //***********
  DDRB = B00111100;//make pin 13,12,11,10 output
  DDRD = B11110000;//pin 7,6,5,4 
}

void loop()
{
 
 for(int i=0;i<=19;i++)
  {
//    uint32_t ts1 = micros();
    
    int f=(pgm_read_word_near(&triwave[i])); 
    int a=f;
    int b=f+200;
    int c=f+400;
    int d=f+600;

     if((i%2)==0)
     {
        counta++;
     }
     if(counta>=200)
     {
        counta=0; 
     }
    
     int r=pgm_read_word_near(&sinwave[counta]);



      ADCSRA|=(1<<ADSC);
       j=ADC;

 


         if(r>=d)
         {
          
           PORTB = B00111100;
           PORTD = B00000000;
          delayMicroseconds(ref);
         // _delay_us(0.5);
          
         }
         else if(r>=c)
         {
          PORTB = B00011100;
          PORTD = B10000000;
          delayMicroseconds(ref);
         // _delay_us(0.5);
         }
         else if(r>=b)
         {
          PORTB = B00001100;
          PORTD = B11000000;
          delayMicroseconds(ref);
         // _delay_us(0.5);
          
         }
         else if(r>=a)
         {
           
            PORTB = B00000100;
            PORTD = B11100000;
            delayMicroseconds(ref);
           // _delay_us(0.5);
          
         }
         else
          {
           
            PORTB = B00000000;
            PORTD = B11110000;
            delayMicroseconds(ref);
           // _delay_us(0.5);
             
          }
          
//        uint32_t ts2 = micros();
//        Serial.println(ts2-ts1-4);
        

     
  }

   
     
}



